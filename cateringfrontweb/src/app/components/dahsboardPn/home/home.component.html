<div class="hero-section imgg">
  <div class="container my-5 py-5">
    <div class="row align-items-center g-5">
      <div class="col-lg-6 text-lg-start">
        <h1 class="hero-title animated slideInLeft">Commandez vos repas à bord</h1>
        <p class="hero-subtitle animated slideInLeft mb-4 pb-2">En toute simplicité.</p>
        <button class="btn btn-primary btn-lg animated slideInLeft"  aria-label="Découvrir les menus" >
        </button>
      </div>
    </div>
  </div>
</div>

<div class="restaurant-section">
  <div class="section-header">
    <h2 class="section-title">Nos Menus Disponibles</h2>
    <p class="section-description">
      Découvrez nos menus du jour avec 
      <span class="highlight-text">des plats frais et savoureux</span>
    </p>
  </div>

  <div *ngIf="!menus.length" class="loading-container">
    <div class="loading-spinner">
      <div class="spinner"></div>
      <p>Chargement des menus...</p>
    </div>
  </div>

  <div class="menus-grid" *ngIf="menus.length">
    <div class="menu-card" *ngFor="let menu of menus" [class.unavailable]="!menu.Disponible">
      <!-- Card Header -->
      <div class="card-header">

      <!-- Menu Images Grid -->
      <div class="menu-images">
        <div class="images-container">
          <!-- Entrée -->
          <div class="image-item" *ngIf="menu.PlatsEntree[0]">
            <img 
              [src]="getImageUrl(menu.PlatsEntree[0].image)" 
              [alt]="menu.PlatsEntree[0].nom || 'Entrée'"
              loading="lazy"
              (error)="handleImageError($event, 'Entrée', menu.nom)"
            />
            <div class="image-overlay">
              <span class="dish-category">Entrée</span>
              <span class="dish-name">{{menu.PlatsEntree[0].nom}}</span>
            </div>
          </div>

          <!-- Plat Principal -->
          <div class="image-item" *ngIf="menu.PlatsPrincipaux[0]">
            <img 
              [src]="getImageUrl(menu.PlatsPrincipaux[0].image)" 
              [alt]="menu.PlatsPrincipaux[0].nom || 'Plat Principal'"
              loading="lazy"
              (error)="handleImageError($event, 'Plat Principal', menu.nom)"
            />
            <div class="image-overlay">
              <span class="dish-category">Plat Principal</span>
              <span class="dish-name">{{menu.PlatsPrincipaux[0].nom}}</span>
            </div>
          </div>

          <!-- Dessert -->
          <div class="image-item" *ngIf="menu.PlatsDessert[0]">
            <img 
              [src]="getImageUrl(menu.PlatsDessert[0].image)" 
              [alt]="menu.PlatsDessert[0].nom || 'Dessert'"
              loading="lazy"
              (error)="handleImageError($event, 'Dessert', menu.nom)"
            />
            <div class="image-overlay">
              <span class="dish-category">Dessert</span>
              <span class="dish-name">{{menu.PlatsDessert[0].nom}}</span>
            </div>
          </div>

          <!-- Boisson -->
          <div class="image-item" *ngIf="menu.Boissons[0]">
            <img 
              [src]="getImageUrl(menu.Boissons[0].image)" 
              [alt]="menu.Boissons[0].nom || 'Boisson'"
              loading="lazy"
              (error)="handleImageError($event, 'Boisson', menu.nom)"
            />
            <div class="image-overlay">
              <span class="dish-category">Boisson</span>
              <span class="dish-name">{{menu.Boissons[0].nom}}</span>
            </div>
          </div>
        </div>
      </div>

      <!-- Menu Content -->
      <div class="menu-content">
        <div class="menu-header">
          <h3 class="menu-name">{{ menu.nom }}</h3>
          <div class="availability-status" [class.available]="menu.Disponible">
            <div class="status-dot"></div>
            <span class="status-text">
              {{ menu.Disponible ? 'Disponible' : 'Indisponible' }}
            </span>
          </div>
        </div>

        <div class="menu-composition">
          <div class="composition-item" *ngIf="menu.PlatsEntree[0]">
            <i class="fas fa-utensils composition-icon"></i>
            <div class="composition-details">
              <span class="composition-label">Entrée</span>
              <span class="composition-value">{{menu.PlatsEntree[0].nom || 'Non spécifié'}}</span>
            </div>
          </div>

          <div class="composition-item" *ngIf="menu.PlatsPrincipaux[0]">
            <i class="fas fa-drumstick-bite composition-icon"></i>
            <div class="composition-details">
              <span class="composition-label">Plat Principal</span>
              <span class="composition-value">{{menu.PlatsPrincipaux[0].nom || 'Non spécifié'}}</span>
            </div>
          </div>

          <div class="composition-item" *ngIf="menu.PlatsDessert[0]">
            <i class="fas fa-ice-cream composition-icon"></i>
            <div class="composition-details">
              <span class="composition-label">Dessert</span>
              <span class="composition-value">{{menu.PlatsDessert[0].nom || 'Non spécifié'}}</span>
            </div>
          </div>

          <div class="composition-item" *ngIf="menu.Boissons[0]">
            <i class="fas fa-glass-whiskey composition-icon"></i>
            <div class="composition-details">
              <span class="composition-label">Boisson</span>
              <span class="composition-value">{{menu.Boissons[0].nom || 'Non spécifié'}}</span>
            </div>
          </div>
        </div>

        <div class="menu-actions">
          <button 
            class="btn-select-menu"
            [disabled]="!menu.Disponible"
            (click)="commanderMenu(menu.nom)"
            [attr.aria-label]="menu.Disponible ? 'Sélectionner le menu ' + menu.nom : 'Menu indisponible'">
            <i class="fas fa-check-circle"></i>
            <span>{{ menu.Disponible ? 'Sélectionner ce menu' : 'Indisponible' }}</span>
          </button>
        </div>
      </div>
    </div>
  </div>
</div>

<div class="dish-list-section" id="plats">
  <div class="dish-list-header">
    <h5 class="dish-list-title">Liste des plats</h5>
    <p class="dish-list-description">
      Composez votre menu selon vos envies parmi notre sélection de <span class="highlight-text">plats variés</span>.
    </p>
  </div>

  <ul class="tab-list" role="tablist">
    <li role="presentation">
      <a id="tab-1-tab" data-bs-toggle="pill" href="#tab-1" role="tab" aria-controls="tab-1" aria-selected="true" class="active">
        <i class="fas fa-utensils"></i>
        <span>Entrée</span>
      </a>
    </li>
    <li role="presentation">
      <a id="tab-2-tab" data-bs-toggle="pill" href="#tab-2" role="tab" aria-controls="tab-2" aria-selected="false">
        <i class="fas fa-drumstick-bite"></i>
        <span>Plat principal</span>
      </a>
    </li>
    <li role="presentation">
      <a id="tab-3-tab" data-bs-toggle="pill" href="#tab-3" role="tab" aria-controls="tab-3" aria-selected="false">
        <i class="fas fa-ice-cream"></i>
        <span>Dessert</span>
      </a>
    </li>
    <li role="presentation">
      <a id="tab-4-tab" data-bs-toggle="pill" href="#tab-4" role="tab" aria-controls="tab-4" aria-selected="false">
        <i class="fas fa-glass-whiskey"></i>
        <span>Boissons</span>
      </a>
    </li>
    <li role="presentation">
      <a id="tab-5-tab" data-bs-toggle="pill" href="#tab-5" role="tab" aria-controls="tab-5" aria-selected="false">
        <i class="fas fa-coffee"></i>
        <span>Petit déjeuner</span>
      </a>
    </li>
  </ul>

  <div class="tab-content">
    <!-- Entrée -->
    <div id="tab-1" class="tab-pane fade show active" role="tabpanel" aria-labelledby="tab-1-tab">
      <div class="dish-grid">
        <div class="dish-item" *ngFor="let entree of PlatsEntree" [class.selected]="EntreeSelectionne === entree" [class.unavailable]="!entree.Disponibilite">
          <div class="dish-image">
            <img *ngIf="entree.image" [src]="getImageUrl(entree.image)" [alt]="entree.nom" loading="lazy" (error)="handleImageError($event, 'Entrée', entree.nom)" />
          </div>
          <div class="dish-content">
            <div class="dish-header">
              <h5 class="dish-name">{{ entree.nom }}</h5>
              <button class="btn-add-dish" 
                      (click)="SelectedMeal(entree, 'Entrée')" 
                      [disabled]="!entree.Disponibilite || (EntreeSelectionne && EntreeSelectionne !== entree)"
                      [attr.aria-label]="entree.Disponibilite ? 'Ajouter ' + entree.nom + ' au panier' : 'Plat indisponible'"
                      [title]="entree.Disponibilite ? 'Ajouter au panier' : 'Indisponible'">
                <i class="fas fa-plus"></i>
              </button>
            </div>
            <small class="dish-description">{{ entree.description }}</small>
          </div>
        </div>
      </div>
    </div>

    <!-- Plat Principal -->
    <div id="tab-2" class="tab-pane fade" role="tabpanel" aria-labelledby="tab-2-tab">
      <div class="dish-grid">
        <div class="dish-item" *ngFor="let principal of PlatsPrincipaux" [class.selected]="PrincipauxSelectionne === principal" [class.unavailable]="!principal.Disponibilite">
          <div class="dish-image">
            <img *ngIf="principal.image" [src]="getImageUrl(principal.image)" [alt]="principal.nom" loading="lazy" (error)="handleImageError($event, 'Plat Principal', principal.nom)" />
          </div>
          <div class="dish-content">
            <div class="dish-header">
              <h5 class="dish-name">{{ principal.nom }}</h5>
              <button class="btn-add-dish" 
                      (click)="SelectedMeal(principal, 'Plat Principal')" 
                      [disabled]="!principal.Disponibilite || (PrincipauxSelectionne && PrincipauxSelectionne !== principal)"
                      [attr.aria-label]="principal.Disponibilite ? 'Ajouter ' + principal.nom + ' au panier' : 'Plat indisponible'"
                      [title]="principal.Disponibilite ? 'Ajouter au panier' : 'Indisponible'">
                <i class="fas fa-plus"></i>
              </button>
            </div>
            <small class="dish-description">{{ principal.description }}</small>
          </div>
        </div>
      </div>
    </div>

    <!-- Dessert -->
    <div id="tab-3" class="tab-pane fade" role="tabpanel" aria-labelledby="tab-3-tab">
      <div class="dish-grid">
        <div class="dish-item" *ngFor="let dessert of PlatsDessert" [class.selected]="DessertSelectionne === dessert" [class.unavailable]="!dessert.Disponibilite">
          <div class="dish-image">
            <img *ngIf="dessert.image" [src]="getImageUrl(dessert.image)" [alt]="dessert.nom" loading="lazy" (error)="handleImageError($event, 'Dessert', dessert.nom)" />
          </div>
          <div class="dish-content">
            <div class="dish-header">
              <h5 class="dish-name">{{ dessert.nom }}</h5>
              <button class="btn-add-dish" 
                      (click)="SelectedMeal(dessert, 'Dessert')" 
                      [disabled]="!dessert.Disponibilite || (DessertSelectionne && DessertSelectionne !== dessert)"
                      [attr.aria-label]="dessert.Disponibilite ? 'Ajouter ' + dessert.nom + ' au panier' : 'Plat indisponible'"
                      [title]="dessert.Disponibilite ? 'Ajouter au panier' : 'Indisponible'">
                <i class="fas fa-plus"></i>
              </button>
            </div>
            <small class="dish-description">{{ dessert.description }}</small>
          </div>
        </div>
      </div>
    </div>

    <!-- Boissons -->
    <div id="tab-4" class="tab-pane fade" role="tabpanel" aria-labelledby="tab-4-tab">
      <div class="dish-grid">
        <div class="dish-item" *ngFor="let b of Boissons" [class.selected]="BoissonsSelectionne === b" [class.unavailable]="!b.Disponibilite">
          <div class="dish-image">
            <img *ngIf="b.image" [src]="getImageUrl(b.image)" [alt]="b.nom" loading="lazy" (error)="handleImageError($event, 'Boisson', b.nom)" />
          </div>
          <div class="dish-content">
            <div class="dish-header">
              <h5 class="dish-name">{{ b.nom }}</h5>
              <button class="btn-add-dish" 
                      (click)="SelectedMeal(b, 'Boisson')" 
                      [disabled]="!b.Disponibilite || (BoissonsSelectionne && BoissonsSelectionne !== b)"
                      [attr.aria-label]="b.Disponibilite ? 'Ajouter ' + b.nom + ' au panier' : 'Plat indisponible'"
                      [title]="b.Disponibilite ? 'Ajouter au panier' : 'Indisponible'">
                <i class="fas fa-plus"></i>
              </button>
            </div>
            <small class="dish-description">{{ b.description }}</small>
          </div>
        </div>
      </div>
    </div>

    <!-- Petit déjeuner -->
    <div id="tab-5" class="tab-pane fade" role="tabpanel" aria-labelledby="tab-5-tab">
      <div class="dish-grid">
        <div class="dish-item" *ngFor="let dj of Petitdejuner" [class.selected]="DejunerSelectionne.includes(dj)" [class.unavailable]="!dj.Disponibilite">
          <div class="dish-image">
            <img *ngIf="dj.image" [src]="getImageUrl(dj.image)" [alt]="dj.nom" loading="lazy" (error)="handleImageError($event, 'Petit déjeuner', dj.nom)" />
          </div>
          <div class="dish-content">
            <div class="dish-header">
              <h5 class="dish-name">{{ dj.nom }}</h5>
              <button class="btn-add-dish" 
                      (click)="SelectedMeal(dj, 'Petit déjeuner')"
                      [disabled]="!dj.Disponibilite"
                      [attr.aria-label]="dj.Disponibilite ? 'Ajouter ' + dj.nom + ' au panier' : 'Plat indisponible'"
                      [title]="dj.Disponibilite ? 'Ajouter au panier' : 'Indisponible'">
                <i class="fas fa-plus"></i>
              </button>
            </div>
            <small class="dish-description">{{ dj.description }}</small>
          </div>
        </div>
      </div>
    </div>

    <!-- Go to Cart Button -->
    <div class="dish-action" *ngIf="afficherButtonPanier()">
      <button class="btn-go-to-cart" (click)="allerAuPanier()" aria-label="Aller au panier">
        <i class="fas fa-shopping-cart"></i> Aller au panier
      </button>
    </div>
  </div>
</div>


<!--Chatbot from codepen.io -->
<button class="chat-toggle-btn" (click)="toggleChat()">
  {{ isChatOpen ? 'Fermer le Chatbot' : 'Ouvrir le Chatbot' }}
</button>

<div class="chat-container" *ngIf="isChatOpen">
  <div class="chat-header">
    <h2>Catering Chatbot</h2>
  </div>
  
  <div class="chat-messages" id="messages">
    <div class="receipt">
      <div *ngFor="let msg of messages" class="message" [class.bot]="msg.sender === 'Bot'" [class.user]="msg.sender === 'Vous'">
        <strong>{{ msg.sender }} :</strong> {{ msg.text }}
        <span class="timestamp">{{ msg.timestamp }}</span>
      </div>
    </div>
  </div>

  <div class="input-container">
    <input type="text" [(ngModel)]="userInput" (keyup.enter)="send()" placeholder="Écrivez votre message...">
    <button (click)="send()">Envoyer</button>
  </div>

<p-toast></p-toast>