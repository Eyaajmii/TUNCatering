<div class="prelevement-container">
  <h2>Mes Prélèvements</h2>

  <div *ngIf="loading">Chargement...</div>
  <div *ngIf="error" class="error">{{ error }}</div>

  <table *ngIf="!loading && prelevements.length > 0">
    <thead>
      <tr>
        <th>#</th>
        <th>Période</th>
        <th>Montant</th>
        <th>Statut</th>
      </tr>
    </thead>
    <tbody>
      <ng-container *ngFor="let p of prelevements; let i = index">
        <tr (click)="toggleDetails(p._id)" style="cursor: pointer;">
          <td>{{ i + 1 }}</td>
          <td>{{ p.dateDebut | date:'dd/MM/yyyy' }} - {{ p.dateFin | date:'dd/MM/yyyy' }}</td>
          <td>{{ p.montantTotal }} TND</td>
          <td>
            <span *ngIf="p.annulation; else actif" class="annule">
              <i class="fas fa-ban"></i> Prélèvement annulé
            </span>
            <ng-template #actif>
              <i class="fas fa-check-circle text-success"></i> Actif
            </ng-template>
          </td>
        </tr>
        <tr *ngIf="selectedPrelevId === p._id && selectedPrelevDetail">
          <td colspan="6">
            <div class="detail-card p-3 bg-light rounded shadow-sm">
              <h5 class="mb-3">Détails du prélèvement</h5>
              <ul class="list-group">
                <li *ngFor="let detail of selectedPrelevDetail" class="list-group-item d-flex justify-content-between align-items-center">
                  <strong>Vol :</strong> <span>{{ detail.vol?.numVol }}</span>
                  <strong>Montant :</strong> <span>{{ detail.montant | number: '1.2-2' }} TND</span>
                </li>                
              </ul>
            </div>
          </td>
        </tr>               
      </ng-container>
    </tbody>
  </table>

  <div *ngIf="!loading && prelevements.length === 0">
    Aucun prélèvement trouvé.
  </div>
</div>
