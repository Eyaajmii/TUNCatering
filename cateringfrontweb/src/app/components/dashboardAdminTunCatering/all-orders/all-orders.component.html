<div class="content">
  <div class="container">
    <h2 class="mb-5">Les commandes</h2>

    <div class="connection-status" [class.connected]="connectionStatus" [class.disconnected]="!connectionStatus">
      {{ connectionStatus ? 'Connecté' : 'Déconnecté' }}
    </div>

    <div *ngIf="error" class="alert alert-danger">
      {{ error }}
    </div>

    <div *ngIf="loading" class="loading-indicator">
      Chargement des commandes...
    </div>

    <div class="filters mb-3">
      <select [(ngModel)]="filtres.statut" class="form-control">
        <option value="tous">Toutes les commandes</option>
        <option *ngFor="let status of availableStatuses" [value]="status.value">
          {{ status.display }}
        </option>
      </select>
    </div>

    <div class="table-responsive">
      <table class="table table-striped custom-table">
        <thead>
          <tr>
            <th scope="col">ID</th>
            <th scope="col">Vol</th>
            <th scope="col">Matricule </th>
            <th scope="col">Menu/Plats</th>
            <th scope="col">Nombre de commande</th>
            <th scope="col">Statut</th>
          </tr>
        </thead>
        <tbody *ngIf="!loading && !error">
          <tr *ngFor="let commande of filteredCommands">
            <td>#{{ formatId(commande._id) }}</td>
            <td>{{ commande.vol?.numVol }}</td>
            <td>
              <div *ngIf="!commande.MatriculeDirTunCater?.Matricule">
                <div>Personnel navigant</div>
              </div>
              <div *ngIf="commande.MatriculeDirTunCater?.Matricule">
                <div>Direction du catering chez Tunisair</div>
                <div>{{ commande.MatriculeDirTunCater?.Matricule }}</div>
              </div>
              
              <div>{{ commande.MatriculePn?.Matricule }}</div>
            </td>            
          
            <td>
              {{ commande.menu?.nom  }}
              <ul>
                <li *ngFor="let plat of commande.plats">
                  {{ plat.nom }}
                </li>
              </ul>
            </td>
            <td>{{ commande.NombreCommande }}</td>
            <td>
              <select [(ngModel)]="commande.Statut" (change)="changerStatut(commande._id, commande.Statut)" class="form-control">
                <option *ngFor="let status of availableStatuses" [value]="status.value">
                  {{ status.display }}
                </option>
              </select>
            </td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>
</div>
